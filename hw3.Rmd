---
title: "HW3"
author: "Zhenning Zhang"
date: '2022-12-01'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Question 1

Global level git config:
C:/Users/zzn/.gitconfig
(where zzn is my username in English)

Local level git config:
(It's in git repo's .git folder)

And I am using a Windows machine.

(Since I already have an account in my global gitconfig, so I'm no going to override it with UMich account.)

```{r}
system("cat C:/Users/张振宁/.gitconfig")
```

Commands in Git Bash:

pwd
cd Downloads/STATS506/hw3
git init
git add hw3.Rmd
git add .gitignore
git commit

git remote add origin https://github.com/ZhenningZhang/STATS506.git
git branch -M main
git push -u origin main

```{r}
system("cat .gitignore")
```

Question 2

```{r}
# How I technically can read it line by line
filepath = "hw3data/2020_Business_Academic_QCQ.txt"
con = file(filepath, "r")
readLines(con, n = 1)
```

```{r}
library(data.table)

# but fread is simply too OP
varnames = c("State", "County Code", "Employee Size (5) - Location", "Sales Volume (9) - Location", "Census Tract")

# There is not a lot of variables, so just hard coding
readdata = function(n1=1, n2=10) {
  data = fread(filepath, nrows=n2, select=varnames)
  colnames(data) = c("state", "county_code", "employee_size_location", "sales_volume_location", "census_tract")
  if(n1!=1)
    data = data[-(1:(n1-1)),]
  return(data[complete.cases(data),])
}
```

Question 3

```{r}
AL = readdata(1,300000)

library(tidyverse)

df1 = AL %>% group_by(census_tract) %>% summarise(employee_size = sum(employee_size_location), sales_volume = sum(sales_volume_location)) 
```

Question 4

SET GLOBAL local_infile=1;

CREATE DATABASE Hw3db;

CREATE TABLE df1 (
	census_tract int primary key,
    employee_size int,
    sales_volume int
);

```{r}
library(RMySQL)

myDB = dbConnect(MySQL(),user="root",password="ZhenningZhang20011030#",host="localhost",port=3306,db="Hw3db")

dbWriteTable(myDB,name="df1",value=df1,append = TRUE,row.names = FALSE)
```

Question 5

```{r}
fetch(dbSendQuery(myDB,"SELECT * FROM df1 ORDER BY sales_volume DESC LIMIT 10"))
```

Question 6

git add hw3.Rmd
git commit
git push -u origin main

git branch newbranch
git switch newbranch
git branch -a

(what is remotes/origin/maim here?)
git add hw3.Rmd
git commit
git push -u origin newbranch
(and what is origin means?)


Question 7

```{r}
varnames = c("FIELD19", "FIELD20", "FIELD22", "FIELD45", "FIELD64", "FIELD65")
actualnames = c("wealth","income","home_value","state","county_code","census_tract")

data2 = fread("hw3data/AL.csv",select=varnames)
colnames(data2) = actualnames
data2 = data2 %>% filter(home_value!=0)
```

```{r}
# I'm not sure if it is a good practice just to use same variable names
df2 = data2 %>% group_by(census_tract) %>% summarise(income = sum(income), wealth = sum(wealth), home_value = sum(home_value))
```

Question 8

```{r}
dbWriteTable(myDB,name="df2",value=df2)
```

ALTER TABLE df2
ADD PRIMARY KEY (census_tract);

Question 9




